# docker-compose.override.yml
services:
  web:
    volumes:
      # keep live-reload code mount
      - ../app:/app:cached
      # mount gunicorn config to a path NOT under /app, so it won't be shadowed
      - ../docker/gunicorn_conf.py:/etc/gunicorn/gunicorn_conf.py:ro
    env_file:
      - ./.env.dev
    command: ["/usr/local/bin/entrypoint.sh"]
  frontend:
    build:
      context: ..
      dockerfile: docker/frontend.dev.Dockerfile
    image: yourapp/frontend:${TAG:-dev}
    ports:
      - "5173:5173"
    environment:
      - NODE_ENV=development
      - CHOKIDAR_USEPOLLING=true
      - WATCHPACK_POLLING=true
      - VITE_API_ORIGIN=http://localhost:5173
      - VITE_BACKEND_URL=http://web:8000
    volumes:
      - ../frontend:/app
      - /app/node_modules
    command: >
      sh -c "npm install --include=dev && npm run dev -- --host --port 5173"
