# docker-compose.override.yml
services:
  web:
    volumes:
      # keep live-reload code mount
      - ../app:/app:cached
      # mount gunicorn config to a path NOT under /app, so it won't be shadowed
      - ../docker/gunicorn_conf.py:/etc/gunicorn/gunicorn_conf.py:ro
    command: >
      sh -c "gunicorn app.wsgi:app -c /etc/gunicorn/gunicorn_conf.py --reload --reload-engine=poll"
  frontend:
    build:
      context: ..
      dockerfile: docker/frontend.dev.Dockerfile
    image: yourapp/frontend:${TAG:-dev}
    depends_on:
      - web
    ports:
      - "5173:5173"
    environment:
      - NODE_ENV=development
      - CHOKIDAR_USEPOLLING=true
      - VITE_BACKEND_URL=http://web:8000
    volumes:
      - ../frontend:/app              # mount your code
    command: >
      sh -c "npm install --include=dev && npm run dev -- --host --port 5173"